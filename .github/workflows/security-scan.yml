name: My First Security Scan

# This workflow runs whenever you push code
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  security-check:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Download your code
      - name: Checkout code
        uses: actions/checkout@v3
      
      # Step 2: Show what files we have
      - name: Show files in repository
        run: |
          echo "üìÇ Files in repository:"
          ls -la
          echo ""
          echo "üêç Python files found:"
          find . -name "*.py" || echo "No Python files"
      
      # Step 3: Scan for hardcoded secrets
      - name: Check for hardcoded secrets
        run: |
          echo "üîç Scanning for hardcoded secrets..."
          echo "========================================"
          if grep -ri "password\|api_key\|secret\|token\|aws.*key" . --exclude-dir=.git --exclude-dir=.github --exclude="*.yml" --exclude="*.yaml" --color=always; then
            echo "========================================"
            echo "‚ùå CRITICAL: Hardcoded secrets detected!"
            echo "üö´ This deployment is BLOCKED"
            echo "========================================"
            exit 1
          else
            echo "========================================"
            echo "‚úÖ No hardcoded secrets found"
            echo "‚úÖ Security check PASSED"
            echo "========================================"
          fi
      
      # Step 4: Check for unsafe Python functions
      - name: Check Python code for unsafe functions
        run: |
          echo "üêç Scanning Python files for unsafe functions..."
          if find . -name "*.py" -exec grep -Hn "eval\|exec\|pickle" {} \;; then
            echo "‚ö†Ô∏è Warning: Potentially unsafe functions found"
          else
            echo "‚úÖ No unsafe functions detected"
          fi
